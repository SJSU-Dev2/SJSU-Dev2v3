name: 'Run Tests'
description: 'Runs automated tests for SJSU-Dev2 libraries'
runs:
  using: "composite"
  steps:
    - name: ðŸ“¥ Install GCC 11
      shell: bash
      run: |
            echo
            echo "ðŸ“¥ Install GCC 11"
            echo
            sudo add-apt-repository 'deb http://mirrors.kernel.org/ubuntu hirsute main universe'
            sudo apt update
            sudo apt install g++-11

    - name: ðŸ“¥ Install Sammy
      shell: bash
      run: |
            echo
            echo "ðŸ“¥ Install Sammy"
            echo
            python3 -m pip install --user --upgrade sammy-sjsu-dev2

    - name: âœ¨ Create new project
      shell: bash
      run: |
            echo
            echo "âœ¨ Create new project"
            echo
            sammy start project

    - name: ðŸ“¦ Install ${{ github.repository }} library
      shell: bash
      working-directory: project
      run: |
            echo
            echo "ðŸ“¦ Install ${{ github.repository }} library"
            echo
            HEAD_REF=${{ github.head_ref }}
            BRANCH=${HEAD_REF:="main"}
            sammy remove ${{ github.event.repository.name }}
            sammy install --tag "$BRANCH" "https://github.com/${{ github.repository }}.git"

    - name: ðŸ§ª Run Tests
      shell: bash
      working-directory: project/packages/${{ github.event.repository.name }}
      run: |
            echo
            echo "ðŸ§ª Run Tests"
            echo
            sammy build-test -r "tests/unity.test.cpp" -c "g++-11"
